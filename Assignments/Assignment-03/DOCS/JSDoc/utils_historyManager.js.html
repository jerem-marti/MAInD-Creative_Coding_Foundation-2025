<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/historyManager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/historyManager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview History manager module for managing Pong game history.
 * This module provides functionality to store, retrieve, and manage game results
 * using a Map structure and localStorage persistence. Game records are indexed by
 * ISO timestamp strings and contain player data (names and scores) and game mode.
 */

import { getLocalStorageItem, setLocalStorageItem } from './localStorage.js';

/**
 * Map storing game history records indexed by ISO timestamp strings.
 * Each record contains player1, player2 objects with name and score, and game mode.
 * @type {Map&lt;string, {player1: {name: string, score: number}, player2: {name: string, score: number}, mode: string}>}
 */
const history = new Map();

/**
 * Initializes the history Map from localStorage.
 * Retrieves stored game history and populates the history Map with timestamp keys.
 * Should be called once at application startup.
 * 
 * @function initializeHistory
 */
const initializeHistory = () => {
    const storedHistory = getLocalStorageItem('pongGameHistory');
    if (storedHistory) {
        storedHistory.forEach(({ timestamp, ...record }) => {
            history.set(timestamp, record);
        });
    }
}

/**
 * Retrieves all game history records as an array.
 * Converts the history Map to an array of objects, each containing timestamp and game data.
 * 
 * @function getHistory
 * @returns {Array&lt;{timestamp: string, player1: {avatar: string, name: string, score: number}, player2: {avatar: string, name: string, score: number}, mode: string}>} Array of game history records
 */
const getHistory = () => {
    return Array.from(history, ([timestamp, record]) => ({ timestamp, ...record })).toReversed();
}

/**
 * Retrieves the most recent game from history.
 * Returns the last element in the history array, or null if no games exist.
 * 
 * @function getLatestGame
 * @returns {{timestamp: string, player1: {name: string, score: number}, player2: {name: string, score: number}, mode: string}|null} The latest game record or null if history is empty
 */
const getLatestGame = () => {
    const historyArray = getHistory();
    return historyArray.length > 0 ? historyArray[0] : null;
}

/**
 * Saves the current history Map to localStorage.
 * Converts the Map to an array and persists it using the localStorage utility.
 * 
 * @function saveHistory
 */
const saveHistory = () => {
    const historyArray = getHistory();
    setLocalStorageItem('pongGameHistory', historyArray);
}

/**
 * Clears all game history from both the Map and localStorage.
 * Removes all entries from the history Map and persists the empty state.
 * 
 * @function clearHistory
 */
const clearHistory = () => {
    history.clear();
    saveHistory();
};

/**
 * Adds a new game result to the history.
 * Creates a new history entry with the current timestamp and provided game data.
 * Validates that all required data is provided and that scores are numbers.
 * Validates that the game mode is either 'Single Player' or 'Two Players'.
 * Automatically saves the updated history to localStorage.
 * 
 * @function addGameResultToHistory
 * @param {string} player1Avatar - Avatar URL of player 1
 * @param {string} player1Name - Name of player 1
 * @param {number} player1Score - Final score of player 1
 * @param {string} player2Avatar - Avatar URL of player 2
 * @param {string} player2Name - Name of player 2
 * @param {number} player2Score - Final score of player 2
 * @param {string} mode - Game mode ('Single Player' or 'Two Players')
 * @throws {Error} If player names or scores are missing
 * @throws {Error} If scores are not numbers
 * @throws {Error} If game mode is not 'Single Player' or 'Two Players'
 */
const addGameResultToHistory = (player1Avatar, player1Name, player1Score, player2Avatar, player2Name, player2Score, mode) => {
    if (!player1Avatar || !player2Avatar || player1Avatar === '' || player2Avatar === '') {
        throw new Error("Both Player1 and Player2 avatars must be provided.");
    } else if (!player1Name || !player2Name) {
        throw new Error("Both Player1 and Player2 names must be provided.");
    } else if (player1Score === undefined || player2Score === undefined) {
        throw new Error("Both Player1 and Player2 scores must be provided.");
    } else if (typeof player1Score !== 'number' || typeof player2Score !== 'number') {
        throw new Error("Scores must be numbers.");
    } else if (mode !== 'Single Player' &amp;&amp; mode !== 'Two Players') {
        console.error("Invalid game mode:", mode);
        throw new Error("Game mode must be either 'Single Player' or 'Two Players'.");
    }
    const timestamp = new Date().toISOString();
    history.set(timestamp, { 
        player1: { avatar: player1Avatar, name: player1Name, score: player1Score }, 
        player2: { avatar: player2Avatar, name: player2Name, score: player2Score },
        mode
    });
    saveHistory();
}

/**
 * Exported history management functions.
 * @exports addGameResultToHistory - Adds a game result to history
 * @exports getHistory - Retrieves all game history
 * @exports getLatestGame - Retrieves the most recent game
 * @exports initializeHistory - Initializes history from localStorage
 * @exports saveHistory - Saves history to localStorage
 * @exports clearHistory - Clears all history
 */
export { addGameResultToHistory, getHistory, getLatestGame, initializeHistory, saveHistory, clearHistory };</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-audio.html">audio</a></li><li><a href="module-clearHistory.html">clearHistory</a></li><li><a href="module-displayEndGame.html">displayEndGame</a></li><li><a href="module-displayGame.html">displayGame</a></li><li><a href="module-displayHistory.html">displayHistory</a></li><li><a href="module-displayNewGame.html">displayNewGame</a></li><li><a href="module-getAvatarUrlEncoded.html">getAvatarUrlEncoded</a></li><li><a href="module-getQueryParamsFromHash.html">getQueryParamsFromHash</a></li><li><a href="module-getScreenOrientation.html">getScreenOrientation</a></li><li><a href="module-setLocalStorageItem.html">setLocalStorageItem</a></li></ul><h3>Classes</h3><ul><li><a href="Avatar.html">Avatar</a></li><li><a href="CanvasElement.html">CanvasElement</a></li><li><a href="Keyboard.html">Keyboard</a></li><li><a href="LineDotted.html">LineDotted</a></li><li><a href="MainLoop.html">MainLoop</a></li><li><a href="Player.html">Player</a></li><li><a href="PongGame.html">PongGame</a></li><li><a href="Rectangle.html">Rectangle</a></li><li><a href="RectangleBouncy.html">RectangleBouncy</a></li><li><a href="Scoreboard.html">Scoreboard</a></li><li><a href="Text.html">Text</a></li><li><a href="Touchscreen.html">Touchscreen</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addGameResultToHistory">addGameResultToHistory</a></li><li><a href="global.html#applyForce">applyForce</a></li><li><a href="global.html#applyMvtToPaddle">applyMvtToPaddle</a></li><li><a href="global.html#applySpeed">applySpeed</a></li><li><a href="global.html#atariAudioButton">atariAudioButton</a></li><li><a href="global.html#atariAudioLose">atariAudioLose</a></li><li><a href="global.html#atariAudioLosePoint">atariAudioLosePoint</a></li><li><a href="global.html#atariAudioPaddleHit">atariAudioPaddleHit</a></li><li><a href="global.html#atariAudioWin">atariAudioWin</a></li><li><a href="global.html#atariAudioWinPoint">atariAudioWinPoint</a></li><li><a href="global.html#avatarApiBaseUrl">avatarApiBaseUrl</a></li><li><a href="global.html#canvasCollision">canvasCollision</a></li><li><a href="global.html#clearAndRefreshCanvas">clearAndRefreshCanvas</a></li><li><a href="global.html#clearHistory">clearHistory</a></li><li><a href="global.html#createBall">createBall</a></li><li><a href="global.html#createPaddle">createPaddle</a></li><li><a href="global.html#destroy">destroy</a></li><li><a href="global.html#displayEndGame">displayEndGame</a></li><li><a href="global.html#displayGame">displayGame</a></li><li><a href="global.html#displayHistory">displayHistory</a></li><li><a href="global.html#displayNewGame">displayNewGame</a></li><li><a href="global.html#displaySection">displaySection</a></li><li><a href="global.html#distanceXto">distanceXto</a></li><li><a href="global.html#distanceYto">distanceYto</a></li><li><a href="global.html#draw">draw</a></li><li><a href="global.html#endGame">endGame</a></li><li><a href="global.html#form">form</a></li><li><a href="global.html#getAvatarUrl">getAvatarUrl</a></li><li><a href="global.html#getAvatarUrlEncoded">getAvatarUrlEncoded</a></li><li><a href="global.html#getCanvasSize">getCanvasSize</a></li><li><a href="global.html#getHistory">getHistory</a></li><li><a href="global.html#getLatestGame">getLatestGame</a></li><li><a href="global.html#getLocalStorageItem">getLocalStorageItem</a></li><li><a href="global.html#getName">getName</a></li><li><a href="global.html#getPaddleKeyboardMvt">getPaddleKeyboardMvt</a></li><li><a href="global.html#getPaddleTouchscreenMvt">getPaddleTouchscreenMvt</a></li><li><a href="global.html#getQueryParamsFromHash">getQueryParamsFromHash</a></li><li><a href="global.html#getScore">getScore</a></li><li><a href="global.html#getScreenOrientation">getScreenOrientation</a></li><li><a href="global.html#getSpeed">getSpeed</a></li><li><a href="global.html#history">history</a></li><li><a href="global.html#historyClearButton">historyClearButton</a></li><li><a href="global.html#historyListElement">historyListElement</a></li><li><a href="global.html#incrementPlayerScore">incrementPlayerScore</a></li><li><a href="global.html#incrementScore">incrementScore</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initializeHistory">initializeHistory</a></li><li><a href="global.html#isDown">isDown</a></li><li><a href="global.html#isInside">isInside</a></li><li><a href="global.html#move">move</a></li><li><a href="global.html#onEnded">onEnded</a></li><li><a href="global.html#playAgainButton">playAgainButton</a></li><li><a href="global.html#playOnce">playOnce</a></li><li><a href="global.html#player1Avatar">player1Avatar</a></li><li><a href="global.html#player1AvatarDefault">player1AvatarDefault</a></li><li><a href="global.html#player1AvatarElement">player1AvatarElement</a></li><li><a href="global.html#player1Input">player1Input</a></li><li><a href="global.html#player1UsernameElement">player1UsernameElement</a></li><li><a href="global.html#player2Avatar">player2Avatar</a></li><li><a href="global.html#player2AvatarDefault">player2AvatarDefault</a></li><li><a href="global.html#player2AvatarElement">player2AvatarElement</a></li><li><a href="global.html#player2Input">player2Input</a></li><li><a href="global.html#player2UsernameElement">player2UsernameElement</a></li><li><a href="global.html#pongGame">pongGame</a></li><li><a href="global.html#rectangleCollision">rectangleCollision</a></li><li><a href="global.html#resetScore">resetScore</a></li><li><a href="global.html#router">router</a></li><li><a href="global.html#saveHistory">saveHistory</a></li><li><a href="global.html#scoreElement">scoreElement</a></li><li><a href="global.html#screenOrientation">screenOrientation</a></li><li><a href="global.html#setForce">setForce</a></li><li><a href="global.html#setLocalStorageItem">setLocalStorageItem</a></li><li><a href="global.html#setPositionRelativeToCanvas">setPositionRelativeToCanvas</a></li><li><a href="global.html#setSpeed">setSpeed</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#title">title</a></li><li><a href="global.html#updateBallsPosition">updateBallsPosition</a></li><li><a href="global.html#updateElementPosRelativeToCanvas">updateElementPosRelativeToCanvas</a></li><li><a href="global.html#updatePaddlesPosition">updatePaddlesPosition</a></li><li><a href="global.html#updatePositionRelativeToCanvas">updatePositionRelativeToCanvas</a></li><li><a href="global.html#updateScore">updateScore</a></li><li><a href="global.html#updateSideScore">updateSideScore</a></li><li><a href="global.html#winnerTextElement">winnerTextElement</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Nov 27 2025 18:15:34 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
